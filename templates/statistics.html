{% extends "base.html" %}

{% block title %}Statistics - Super Tic-Tac-Toe{% endblock %}

{% block content %}
<div class="dev-container">
    <!-- Header -->
    <div style="text-align: center; margin-bottom: 4rem;">
        <h1 id="stats-title" class="mono" style="color: var(--dev-white); font-size: 2.5rem; margin-bottom: 1rem; opacity: 0;"
           data-typewriter="> Your_Statistics" data-typewriter-speed="40" data-typewriter-delay="300">
        </h1>
    </div>

    <!-- Overall Stats with Hover Effects -->
    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 1.5rem; margin-bottom: 4rem;">
        <div class="stat-card" style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(29, 78, 216, 0.05) 100%); border: 1px solid rgba(59, 130, 246, 0.2); padding: 2rem; text-align: center; border-radius: 8px; transition: all 0.3s ease; cursor: pointer;"
             onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 12px 30px rgba(59, 130, 246, 0.2)'"
             onmouseout="this.style.transform='translateY(0px)'; this.style.boxShadow='none'">
            <div style="color: var(--dev-blue); font-size: 2.5rem; margin-bottom: 1rem;">
                <i class="fas fa-gamepad"></i>
            </div>
            <div class="mono" style="color: var(--dev-blue); font-size: 2.8rem; font-weight: 600; margin-bottom: 0.5rem;">{{ stats.total_games }}</div>
            <div class="mono" style="color: var(--dev-text-gray); font-size: 0.9rem;">Total Games</div>
        </div>
        
        <div class="stat-card" style="background: linear-gradient(135deg, rgba(34, 197, 94, 0.1) 0%, rgba(22, 163, 74, 0.05) 100%); border: 1px solid rgba(34, 197, 94, 0.2); padding: 2rem; text-align: center; border-radius: 8px; transition: all 0.3s ease; cursor: pointer;"
             onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 12px 30px rgba(34, 197, 94, 0.2)'"
             onmouseout="this.style.transform='translateY(0px)'; this.style.boxShadow='none'">
            <div style="color: var(--dev-green); font-size: 2.5rem; margin-bottom: 1rem;">
                <i class="fas fa-trophy"></i>
            </div>
            <div class="mono" style="color: var(--dev-green); font-size: 2.8rem; font-weight: 600; margin-bottom: 0.5rem;">{{ stats.victories }}</div>
            <div class="mono" style="color: var(--dev-text-gray); font-size: 0.9rem;">Victories</div>
        </div>
        
        <div class="stat-card" style="background: linear-gradient(135deg, rgba(251, 191, 36, 0.1) 0%, rgba(245, 158, 11, 0.05) 100%); border: 1px solid rgba(251, 191, 36, 0.2); padding: 2rem; text-align: center; border-radius: 8px; transition: all 0.3s ease; cursor: pointer;"
             onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 12px 30px rgba(251, 191, 36, 0.2)'"
             onmouseout="this.style.transform='translateY(0px)'; this.style.boxShadow='none'">
            <div style="color: var(--dev-yellow); font-size: 2.5rem; margin-bottom: 1rem;">
                <i class="fas fa-percentage"></i>
            </div>
            <div class="mono" style="color: var(--dev-yellow); font-size: 2.8rem; font-weight: 600; margin-bottom: 0.5rem;">{{ stats.win_rate }}%</div>
            <div class="mono" style="color: var(--dev-text-gray); font-size: 0.9rem;">Win Rate</div>
        </div>
        
        <div class="stat-card" style="background: linear-gradient(135deg, rgba(168, 85, 247, 0.1) 0%, rgba(147, 51, 234, 0.05) 100%); border: 1px solid rgba(168, 85, 247, 0.2); padding: 2rem; text-align: center; border-radius: 8px; transition: all 0.3s ease; cursor: pointer;"
             onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 12px 30px rgba(168, 85, 247, 0.2)'"
             onmouseout="this.style.transform='translateY(0px)'; this.style.boxShadow='none'">
            <div style="color: var(--dev-blue-light); font-size: 2.5rem; margin-bottom: 1rem;">
                <i class="fas fa-handshake"></i>
            </div>
            <div class="mono" style="color: var(--dev-blue-light); font-size: 2.8rem; font-weight: 600; margin-bottom: 0.5rem;">{{ stats.draws }}</div>
            <div class="mono" style="color: var(--dev-text-gray); font-size: 0.9rem;">Draws</div>
        </div>
    </div>

    <!-- Game Mode Breakdown -->
    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 2rem; margin-bottom: 4rem;">
        
        <!-- AI Performance -->
        <div class="mode-card" style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.05) 0%, rgba(29, 78, 216, 0.02) 100%); border: 1px solid rgba(59, 130, 246, 0.15); padding: 2.5rem; border-radius: 8px; transition: all 0.3s ease; min-height: 400px; display: flex; flex-direction: column;"
             onmouseover="this.style.transform='translateY(-3px)'; this.style.borderColor='rgba(59, 130, 246, 0.3)'"
             onmouseout="this.style.transform='translateY(0px)'; this.style.borderColor='rgba(59, 130, 246, 0.15)'">
            <h2 class="mono" style="color: var(--dev-white); font-size: 1.5rem; margin-bottom: 2rem; display: flex; align-items: center;">
                <i class="fas fa-robot" style="color: var(--dev-blue); margin-right: 0.75rem;"></i>
                AI Performance
            </h2>
            
            <div style="display: flex; flex-direction: column; gap: 1rem; flex: 1;">
                <!-- Easy AI -->
                <div class="ai-stat" style="display: flex; justify-content: space-between; align-items: center; padding: 1.25rem; background: rgba(34, 197, 94, 0.08); border-radius: 6px; border: 1px solid rgba(34, 197, 94, 0.2); transition: all 0.2s ease;"
                     onmouseover="this.style.background='rgba(34, 197, 94, 0.12)'; this.style.transform='scale(1.02)'"
                     onmouseout="this.style.background='rgba(34, 197, 94, 0.08)'; this.style.transform='scale(1)'">
                    <div>
                        <div class="mono" style="color: var(--dev-green); font-size: 1rem; margin-bottom: 0.25rem;">
                            <i class="fas fa-leaf" style="margin-right: 0.5rem;"></i>Easy AI
                        </div>
                        <div class="mono" style="color: var(--dev-text-gray); font-size: 0.8rem;">Beginner Level</div>
                    </div>
                    <div style="text-align: right;">
                        <div class="mono" style="color: var(--dev-green); font-size: 1.5rem; font-weight: 600;">{{ stats.ai_stats.easy.wins }}/{{ stats.ai_stats.easy.total_games }}</div>
                        <div class="mono" style="color: var(--dev-text-gray); font-size: 0.8rem;">wins/matches</div>
                    </div>
                </div>
                
                <!-- Medium AI -->
                <div class="ai-stat" style="display: flex; justify-content: space-between; align-items: center; padding: 1.25rem; background: rgba(251, 191, 36, 0.08); border-radius: 6px; border: 1px solid rgba(251, 191, 36, 0.2); transition: all 0.2s ease;"
                     onmouseover="this.style.background='rgba(251, 191, 36, 0.12)'; this.style.transform='scale(1.02)'"
                     onmouseout="this.style.background='rgba(251, 191, 36, 0.08)'; this.style.transform='scale(1)'">
                    <div>
                        <div class="mono" style="color: var(--dev-yellow); font-size: 1rem; margin-bottom: 0.25rem;">
                            <i class="fas fa-brain" style="margin-right: 0.5rem;"></i>Medium AI
                        </div>
                        <div class="mono" style="color: var(--dev-text-gray); font-size: 0.8rem;">Intermediate Level</div>
                    </div>
                    <div style="text-align: right;">
                        <div class="mono" style="color: var(--dev-yellow); font-size: 1.5rem; font-weight: 600;">{{ stats.ai_stats.medium.wins }}/{{ stats.ai_stats.medium.total_games }}</div>
                        <div class="mono" style="color: var(--dev-text-gray); font-size: 0.8rem;">wins/matches</div>
                    </div>
                </div>
                
                <!-- Hard AI -->
                <div class="ai-stat" style="display: flex; justify-content: space-between; align-items: center; padding: 1.25rem; background: rgba(239, 68, 68, 0.08); border-radius: 6px; border: 1px solid rgba(239, 68, 68, 0.2); transition: all 0.2s ease;"
                     onmouseover="this.style.background='rgba(239, 68, 68, 0.12)'; this.style.transform='scale(1.02)'"
                     onmouseout="this.style.background='rgba(239, 68, 68, 0.08)'; this.style.transform='scale(1)'">
                    <div>
                        <div class="mono" style="color: var(--dev-red); font-size: 1rem; margin-bottom: 0.25rem;">
                            <i class="fas fa-fire" style="margin-right: 0.5rem;"></i>Hard AI
                        </div>
                        <div class="mono" style="color: var(--dev-text-gray); font-size: 0.8rem;">Expert Level</div>
                    </div>
                    <div style="text-align: right;">
                        <div class="mono" style="color: var(--dev-red); font-size: 1.5rem; font-weight: 600;">{{ stats.ai_stats.hard.wins }}/{{ stats.ai_stats.hard.total_games }}</div>
                        <div class="mono" style="color: var(--dev-text-gray); font-size: 0.8rem;">wins/matches</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Multiplayer Performance -->
        <div class="mode-card" style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.05) 0%, rgba(5, 150, 105, 0.02) 100%); border: 1px solid rgba(16, 185, 129, 0.15); padding: 2.5rem; border-radius: 8px; transition: all 0.3s ease; min-height: 400px; display: flex; flex-direction: column;"
             onmouseover="this.style.transform='translateY(-3px)'; this.style.borderColor='rgba(16, 185, 129, 0.3)'"
             onmouseout="this.style.transform='translateY(0px)'; this.style.borderColor='rgba(16, 185, 129, 0.15)'">
            <h2 class="mono" style="color: var(--dev-white); font-size: 1.5rem; margin-bottom: 2rem; display: flex; align-items: center;">
                <i class="fas fa-users" style="color: var(--dev-green); margin-right: 0.75rem;"></i>
                Multiplayer
            </h2>
            
            <div style="display: flex; flex-direction: column; gap: 1rem; flex: 1;">
                <!-- Local PvP -->
                <div class="mp-stat" style="display: flex; justify-content: space-between; align-items: center; padding: 1.25rem; background: rgba(16, 185, 129, 0.08); border-radius: 6px; border: 1px solid rgba(16, 185, 129, 0.2); transition: all 0.2s ease;"
                     onmouseover="this.style.background='rgba(16, 185, 129, 0.12)'; this.style.transform='scale(1.02)'"
                     onmouseout="this.style.background='rgba(16, 185, 129, 0.08)'; this.style.transform='scale(1)'">
                    <div>
                        <div class="mono" style="color: var(--dev-green); font-size: 1rem; margin-bottom: 0.25rem;">
                            <i class="fas fa-home" style="margin-right: 0.5rem;"></i>Local PvP
                        </div>
                        <div class="mono" style="color: var(--dev-text-gray); font-size: 0.8rem;">Same Device</div>
                    </div>
                    <div style="text-align: right;">
                        <div class="mono" style="color: var(--dev-green); font-size: 1.5rem; font-weight: 600;">{{ stats.pvp_stats.wins }}/{{ stats.pvp_stats.total_games }}</div>
                        <div class="mono" style="color: var(--dev-text-gray); font-size: 0.8rem;">wins/matches</div>
                    </div>
                </div>
                
                <!-- Online PvP -->
                <div class="mp-stat" style="display: flex; justify-content: space-between; align-items: center; padding: 1.25rem; background: rgba(239, 68, 68, 0.08); border-radius: 6px; border: 1px solid rgba(239, 68, 68, 0.2); transition: all 0.2s ease;"
                     onmouseover="this.style.background='rgba(239, 68, 68, 0.12)'; this.style.transform='scale(1.02)'"
                     onmouseout="this.style.background='rgba(239, 68, 68, 0.08)'; this.style.transform='scale(1)'">
                    <div>
                        <div class="mono" style="color: var(--dev-red); font-size: 1rem; margin-bottom: 0.25rem;">
                            <i class="fas fa-wifi" style="margin-right: 0.5rem;"></i>Online PvP
                        </div>
                        <div class="mono" style="color: var(--dev-text-gray); font-size: 0.8rem;">Real-time</div>
                    </div>
                    <div style="text-align: right;">
                        <div class="mono" style="color: var(--dev-red); font-size: 1.5rem; font-weight: 600;">0/0</div>
                        <div class="mono" style="color: var(--dev-text-gray); font-size: 0.8rem;">wins/matches</div>
                    </div>
                </div>
                
                <!-- Overall Multiplayer -->
                <div class="mp-stat" style="display: flex; justify-content: space-between; align-items: center; padding: 1.25rem; background: rgba(168, 85, 247, 0.08); border-radius: 6px; border: 1px solid rgba(168, 85, 247, 0.2); transition: all 0.2s ease;"
                     onmouseover="this.style.background='rgba(168, 85, 247, 0.12)'; this.style.transform='scale(1.02)'"
                     onmouseout="this.style.background='rgba(168, 85, 247, 0.08)'; this.style.transform='scale(1)'">
                    <div>
                        <div class="mono" style="color: var(--dev-purple); font-size: 1rem; margin-bottom: 0.25rem;">
                            <i class="fas fa-trophy" style="margin-right: 0.5rem;"></i>Total Multiplayer
                        </div>
                        <div class="mono" style="color: var(--dev-text-gray); font-size: 0.8rem;">Combined Stats</div>
                    </div>
                    <div style="text-align: right;">
                        <div class="mono" style="color: var(--dev-purple); font-size: 1.5rem; font-weight: 600;">{{ stats.pvp_stats.wins }}/{{ stats.pvp_stats.total_games }}</div>
                        <div class="mono" style="color: var(--dev-text-gray); font-size: 0.8rem;">wins/matches</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Win Rate Comparison Chart -->
    <div class="chart-card" style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.05) 0%, rgba(29, 78, 216, 0.02) 100%); border: 1px solid rgba(59, 130, 246, 0.15); padding: 2.5rem; border-radius: 8px; margin-bottom: 2rem;">
        <h2 class="mono" style="color: var(--dev-white); font-size: 1.5rem; margin-bottom: 2rem; display: flex; align-items: center;">
            <i class="fas fa-chart-bar" style="color: var(--dev-blue); margin-right: 0.75rem;"></i>
            Win Rate Comparison
        </h2>
        
        <div class="win-rate-chart" style="display: flex; flex-direction: column; gap: 1.5rem;">
            <!-- Easy AI Bar -->
            <div class="chart-row">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                    <span class="mono" style="color: var(--dev-green); font-size: 0.9rem;">
                        <i class="fas fa-leaf" style="margin-right: 0.5rem;"></i>Easy AI
                    </span>
                    <span class="mono win-rate-value" style="color: var(--dev-green); font-size: 0.9rem;" data-value="{{ (stats.ai_stats.easy.wins / stats.ai_stats.easy.total_games * 100) if stats.ai_stats.easy.total_games > 0 else 0 }}">0%</span>
                </div>
                <div class="chart-bar-container" style="background: rgba(34, 197, 94, 0.1); height: 25px; border-radius: 4px; overflow: hidden;">
                    <div class="chart-bar" style="background: linear-gradient(90deg, var(--dev-green), rgba(34, 197, 94, 0.8)); height: 100%; width: 0%; transition: width 2s ease-out; border-radius: 4px;" data-width="{{ (stats.ai_stats.easy.wins / stats.ai_stats.easy.total_games * 100) if stats.ai_stats.easy.total_games > 0 else 0 }}"></div>
                </div>
            </div>
            
            <!-- Medium AI Bar -->
            <div class="chart-row">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                    <span class="mono" style="color: var(--dev-yellow); font-size: 0.9rem;">
                        <i class="fas fa-brain" style="margin-right: 0.5rem;"></i>Medium AI
                    </span>
                    <span class="mono win-rate-value" style="color: var(--dev-yellow); font-size: 0.9rem;" data-value="{{ (stats.ai_stats.medium.wins / stats.ai_stats.medium.total_games * 100) if stats.ai_stats.medium.total_games > 0 else 0 }}">0%</span>
                </div>
                <div class="chart-bar-container" style="background: rgba(251, 191, 36, 0.1); height: 25px; border-radius: 4px; overflow: hidden;">
                    <div class="chart-bar" style="background: linear-gradient(90deg, var(--dev-yellow), rgba(251, 191, 36, 0.8)); height: 100%; width: 0%; transition: width 2s ease-out; border-radius: 4px;" data-width="{{ (stats.ai_stats.medium.wins / stats.ai_stats.medium.total_games * 100) if stats.ai_stats.medium.total_games > 0 else 0 }}"></div>
                </div>
            </div>
            
            <!-- Hard AI Bar -->
            <div class="chart-row">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                    <span class="mono" style="color: var(--dev-red); font-size: 0.9rem;">
                        <i class="fas fa-fire" style="margin-right: 0.5rem;"></i>Hard AI
                    </span>
                    <span class="mono win-rate-value" style="color: var(--dev-red); font-size: 0.9rem;" data-value="{{ (stats.ai_stats.hard.wins / stats.ai_stats.hard.total_games * 100) if stats.ai_stats.hard.total_games > 0 else 0 }}">0%</span>
                </div>
                <div class="chart-bar-container" style="background: rgba(239, 68, 68, 0.1); height: 25px; border-radius: 4px; overflow: hidden;">
                    <div class="chart-bar" style="background: linear-gradient(90deg, var(--dev-red), rgba(239, 68, 68, 0.8)); height: 100%; width: 0%; transition: width 2s ease-out; border-radius: 4px;" data-width="{{ (stats.ai_stats.hard.wins / stats.ai_stats.hard.total_games * 100) if stats.ai_stats.hard.total_games > 0 else 0 }}"></div>
                </div>
            </div>
            
            <!-- Multiplayer Bar -->
            <div class="chart-row">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                    <span class="mono" style="color: var(--dev-purple); font-size: 0.9rem;">
                        <i class="fas fa-users" style="margin-right: 0.5rem;"></i>Multiplayer
                    </span>
                    <span class="mono win-rate-value" style="color: var(--dev-purple); font-size: 0.9rem;" data-value="{{ (stats.pvp_stats.wins / stats.pvp_stats.total_games * 100) if stats.pvp_stats.total_games > 0 else 0 }}">0%</span>
                </div>
                <div class="chart-bar-container" style="background: rgba(168, 85, 247, 0.1); height: 25px; border-radius: 4px; overflow: hidden;">
                    <div class="chart-bar" style="background: linear-gradient(90deg, var(--dev-purple), rgba(168, 85, 247, 0.8)); height: 100%; width: 0%; transition: width 2s ease-out; border-radius: 4px;" data-width="{{ (stats.pvp_stats.wins / stats.pvp_stats.total_games * 100) if stats.pvp_stats.total_games > 0 else 0 }}"></div>
                </div>
            </div>
        </div>
    </div>

    {% if stats.total_games > 10 %}
    <!-- Achievement Section -->
    <div class="achievement-card" style="background: linear-gradient(135deg, rgba(168, 85, 247, 0.1) 0%, rgba(147, 51, 234, 0.05) 100%); border: 1px solid rgba(168, 85, 247, 0.2); padding: 2.5rem; border-radius: 8px; text-align: center; margin-bottom: 2rem; transition: all 0.3s ease;"
         onmouseover="this.style.transform='translateY(-3px)'; this.style.boxShadow='0 12px 30px rgba(168, 85, 247, 0.15)'"
         onmouseout="this.style.transform='translateY(0px)'; this.style.boxShadow='none'">
        <div style="color: var(--dev-purple); font-size: 3rem; margin-bottom: 1rem;">
            <i class="fas fa-star"></i>
        </div>
        <h3 class="mono" style="color: var(--dev-white); font-size: 1.4rem; margin-bottom: 0.5rem;">
            Veteran Player
        </h3>
        <div class="mono" style="color: var(--dev-text-gray); font-size: 0.9rem;">
            You've played {{ stats.total_games }} games! You're becoming a Super Tic-Tac-Toe master.
        </div>
    </div>
    {% endif %}
</div>

<style>
.stat-card {
    position: relative;
    overflow: hidden;
}

.stat-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
    transition: left 0.5s;
}

.stat-card:hover::before {
    left: 100%;
}

.mode-card, .achievement-card {
    position: relative;
    overflow: hidden;
}

.ai-stat, .mp-stat {
    cursor: pointer;
}

.chart-bar {
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.chart-bar-container:hover .chart-bar {
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
    filter: brightness(1.1);
}
</style>

<script>
// Animate chart bars when scrolled into view
document.addEventListener('DOMContentLoaded', function() {
    const chartCard = document.querySelector('.chart-card');
    let hasAnimated = false;
    
    function animateChart() {
        if (hasAnimated) return;
        hasAnimated = true;
        
        const bars = document.querySelectorAll('.chart-bar');
        const values = document.querySelectorAll('.win-rate-value');
        
        bars.forEach((bar, index) => {
            const targetWidth = parseFloat(bar.getAttribute('data-width'));
            bar.style.width = targetWidth + '%';
            
            // Animate the percentage text
            const valueElement = values[index];
            const targetValue = parseFloat(valueElement.getAttribute('data-value'));
            
            let currentValue = 0;
            const increment = targetValue / 60; // 60 steps for smooth animation
            const timer = setInterval(() => {
                currentValue += increment;
                if (currentValue >= targetValue) {
                    currentValue = targetValue;
                    clearInterval(timer);
                }
                valueElement.textContent = Math.round(currentValue) + '%';
            }, 33); // ~30fps
        });
    }
    
    // Create intersection observer to trigger animation when chart comes into view
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                animateChart();
            }
        });
    }, {
        threshold: 0.3 // Trigger when 30% of the chart is visible
    });
    
    if (chartCard) {
        observer.observe(chartCard);
    }
});
</script>

{% endblock %}